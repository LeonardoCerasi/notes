% equation numbering
\makeatletter
\def\tagform@#1{\maketag@@@{\ignorespaces\sffamily(#1)\unskip\@@italiccorr}}
\makeatother

% sectioning
\usepackage{titlesec}

% titleformat{name}
% {title style}
% {number style}
% {space between number and title}
% {before-title code}

\titleformat{\part}[display]
  {\normalfont \sffamily \bfseries \centering}
  {\color{blue!70!black} \Large \partname \, \thepart}
  {10pt} % vertical spacing
  {\Huge}

\titleformat{\chapter}[display]
  {\normalfont \sffamily \bfseries}
  {\color{blue!70!black} \large \chaptertitlename \, \thechapter}
  {1pt}
  {\titlerule[1pt] \vspace{7pt} \Huge}

\titleformat{\section}
  {\normalfont \sffamily \Large}
  {\color{red!70!black} ยง\bfseries\thesection}
  {10pt}
  {\bfseries}

\titleformat{\subsection}
  {\normalfont \sffamily \large}
  {\color{red!70!black} ยง\bfseries\thesubsection}
  {10pt}
  {\bfseries}

\titleformat{\subsubsection}
  {\normalfont \sffamily}
  {\color{red!70!black} ยง\bfseries\thesubsubsection}
  {10pt}
  {\bfseries}

\renewcommand{\appendixtocname}{\sffamily Appendices}
\renewcommand{\appendixpagename}{\sffamily \Huge \bfseries Appendices}

% custom table of contents
\usepackage{tocloft}

\renewcommand{\cfttoctitlefont}{\sffamily \Huge \bfseries} % title font
% part
\renewcommand{\cftpartfont}{\sffamily \large \bfseries}
\renewcommand{\cftpartpagefont}{\sffamily \large \bfseries}
\renewcommand{\cftpartpresnum}{\sffamily \color{blue!70!black}}
% chapter
\renewcommand{\cftchapfont}{\sffamily \bfseries}
\renewcommand{\cftchappagefont}{\sffamily \bfseries}
\renewcommand{\cftchappresnum}{\sffamily \color{blue!70!black}}
% section
\renewcommand{\cftsecfont}{\sffamily}
\renewcommand{\cftsecpagefont}{\sffamily}
\renewcommand{\cftsecpresnum}{\sffamily \color{red!70!black}}
% subsection
\renewcommand{\cftsubsecfont}{\sffamily}
\renewcommand{\cftsubsecpagefont}{\sffamily}
\renewcommand{\cftsubsecpresnum}{\sffamily \color{red!70!black}}

% unnumbered chapter
\titleformat{name = \chapter, numberless}[block]
  {\centering \sffamily \bfseries \Large}
  {}
  {0pt}
  {}

% headers and foooters
\usepackage{fancyhdr}
\setlength{\headheight}{15pt}

% part name
\let\Oldpart\part
\newcommand{\parttitle}{}
\renewcommand{\part}[1]{\Oldpart{#1}\renewcommand{\parttitle}{#1}}

% chapter and section title with \leftmark and \rightmark
\renewcommand{\sectionmark}[1]{\markright{#1}}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}

% no random page numbers
\fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

% custom headers and footers
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}

\fancypagestyle{body}{%
  \fancyhead[LE,RO]{\sffamily\thepage}%
  \fancyhead[LO]{\sffamily \color{blue!70!black}\chaptername\ \thechapter\color{black} :\ \leftmark}%
  \fancyhead[RE]{\sffamily \color{blue!70!black}\partname\ \thepart\color{black} :\ \parttitle}%
}

% special header for the thesis (without parts) --- SECTION NAME HARDCODED
\fancypagestyle{body-thesis}{%
  \fancyhead[LE,RO]{\sffamily\thepage}%
  \fancyhead[LO]{\sffamily \color{blue!70!black}\chaptername\ \thechapter\color{black} :\ \leftmark}%
  \fancyhead[RE]{\sffamily \color{red!70!black}Section\ \thesection\color{black} :\ \rightmark}%
}

% special header for Introduction
\fancypagestyle{introd}{%
  \fancyhead[LE,RO]{\sffamily \thepage}%
  \fancyhead[RE,LO]{\sffamily \leftmark}%
}

% special header for Contents
\fancypagestyle{contents}{%
  \fancyhead[LE,RO]{\sffamily \thepage}%
  \fancyhead[RE,LO]{\sffamily Contents}%
}

% special header for Appendix
\fancypagestyle{append}{%
  \fancyhead[LE,RO]{\sffamily \thepage}%
  \fancyhead[LO]{\sffamily \color{blue!70!black}\appendixname\ \thechapter \color{black}:\ \leftmark}%
  \fancyhead[RE]{\sffamily Appendices}%
}

% special header for Bibliography
\fancypagestyle{biblio}{%
  \fancyhead[LE,RO]{\sffamily \thepage}%
  \fancyhead[RE,LO]{\sffamily Bibliography}%
}

% special header for Abstract
\fancypagestyle{abstract}{%
  \fancyhead[LE,RO]{\sffamily \thepage}%
  \fancyhead[RE,LO]{\sffamily Abstract}%
}

% no blank pages
\let\cleardoublepage\clearpage
% removes indentation
\setlength{\parindent}{0pt}
% add subsubsection numbering
\setcounter{secnumdepth}{3}

% bold text

\newcommand{\bctxt}[1]{\textcolor{blue!70!black}{\sffamily \textbf{#1}}}

\newcommand{\bcdef}[1]{\textcolor{green!50!black}{\sffamily \textbf{#1}}}

\newcommand{\bcth}[1]{\textcolor{red!50!black}{\sffamily \textbf{#1}}}

\newcommand{\bclemma}[1]{\textcolor{blue!35!black}{\sffamily \textbf{#1}}}

\newcommand{\bcprop}[1]{\textcolor{cyan!35!black}{\sffamily \textbf{#1}}}

\newcommand{\bcex}[1]{\textcolor{yellow!35!black}{\sffamily \textbf{#1}}}

\newcommand{\bcobs}[1]{\textcolor{green!35!black!80}{\sffamily \textbf{#1}}}

% fancy environments
\usepackage[many]{tcolorbox}
\BeforeBeginEnvironment{tcolorbox}{\savenotes}
\AfterEndEnvironment{tcolorbox}{\spewnotes}

\tcbuselibrary{theorems}

\NewTcbTheorem[number within=section]{definition}{Definition}{%
  enhanced,%
  breakable,%
  colback = green!10,%
  colframe = green!5,%
  coltitle = green!50!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{def}

\newtcbtheorem[number within=section]{theorem}{Theorem}{%
  enhanced,%
  breakable,%
  colback = red!5,%
  colframe = red!5,%
  coltitle = red!50!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{th}

\newtcbtheorem[number within=tcb@cnt@theorem]{corollary}{Corollary}{%
  enhanced,%
  breakable,%
  colback = red!5,%
  colframe = red!5,%
  coltitle = red!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{cor}

\newtcbtheorem[number within=section]{lemma}{Lemma}{%
  enhanced,%
  breakable,%
  colback = blue!5,%
  colframe = blue!5,%
  coltitle = blue!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{lemma}

\newtcbtheorem[number within=tcb@cnt@lemma]{lemcorollary}{Corollary}{%
  enhanced,%
  breakable,%
  colback = blue!5,%
  colframe = blue!5,%
  coltitle = blue!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{cor}

\newtcbtheorem[number within=section]{proposition}{Proposition}{%
  enhanced,%
  breakable,%
  colback = cyan!5,%
  colframe = cyan!5,%
  coltitle = cyan!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{prop}

\newtcbtheorem[number within=tcb@cnt@proposition]{propcorollary}{Corollary}{%
  enhanced,%
  breakable,%
  colback = cyan!5,%
  colframe = cyan!5,%
  coltitle = cyan!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{cor}

\newtcbtheorem[number within=section]{example}{Example}{%
  enhanced,%
  breakable,%
  colback = yellow!10,%
  colframe = yellow!5,%
  coltitle = yellow!35!black,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{ex}

\newtcbtheorem[number within=section]{observation}{Observation}{%
  enhanced,%
  breakable,%
  colback = green!5,%
  colframe = green!5,%
  coltitle = green!35!black!80,%
  fonttitle = \sffamily\bfseries,%
  sharp corners,%
  boxrule = 0pt,%
  detach title,%
  before upper = {\tcbtitle\\[4pt]},%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  separator sign none,%
  description delimiters parenthesis,%
  description font = \mdseries%
}{obs}

\newtcolorbox{proofbox}{%
  enhanced,%
  breakable,%
  colback = black!5,%
  colframe = black!5,%
  sharp corners,%
  boxrule = 0pt,%
  left = 5pt,%
  right = 5pt,%
  top = 5pt,%
  bottom = 5pt,%
  borderline west = {1pt}{0pt}{black!70},%
}

% custom references
\newcommand{\eref}[1]{\textsf{Eq.\,\ref{#1}}}
\newcommand{\eeref}[2]{\textsf{Eq.\,\ref{#1}-\ref{#2}}}
\newcommand{\ceref}[2]{\textsf{Eq.\,\ref{#1},\ref{#2}}}
\newcommand{\dref}[1]{\textsf{Def.\,\ref{#1}}}
\newcommand{\ddref}[2]{\textsf{Def.\,\ref{#1}-\ref{#2}}}
\newcommand{\tref}[1]{\textsf{Th.\,\ref{#1}}}
\newcommand{\cref}[1]{\textsf{Cor.\,\ref{#1}}}
\newcommand{\pref}[1]{\textsf{Prop.\,\ref{#1}}}
\newcommand{\lref}[1]{\textsf{Lemma\,\ref{#1}}}
\newcommand{\exref}[1]{\textsf{Ex.\,\ref{#1}}}
\newcommand{\obsref}[1]{\textsf{Obs.\,\ref{#1}}}

\newcommand{\figref}[1]{\textsf{Fig.\,\ref{#1}}}

\newcommand{\secref}[1]{\textcolor{red!70!black}{\textsf{ยง\ref{#1}}}}

% hyper-references
\usepackage{hyperref}
\hypersetup{
  colorlinks = true,
  urlcolor = cyan,
  % linkcolor defined directly in \toc environment
  citecolor = green!70!black,
}

\newcommand{\toc}{%
  \hypersetup{linkcolor = black}%
  \tableofcontents%
  \hypersetup{linkcolor = red!70!black}%
}
